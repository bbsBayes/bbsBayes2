<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Stratification • bbsBayes2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Stratification">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bbsBayes2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/bbsBayes2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bbsBayes/bbsBayes2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Stratification</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bbsBayes/bbsBayes2/blob/main/vignettes/articles/stratification.Rmd" class="external-link"><code>vignettes/articles/stratification.Rmd</code></a></small>
      <div class="d-none name"><code>stratification.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bbsBayes/bbsBayes2" class="external-link">bbsBayes2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span>       <span class="co"># Spatial data manipulations</span></span>
<span><span class="co">#&gt; Warning: package 'sf' was built under R version 4.5.2</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>    <span class="co"># General data manipulations</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>  <span class="co"># Plotting</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span> <span class="co"># mutli-plot</span></span>
<span><span class="co">#&gt; Warning: package 'patchwork' was built under R version 4.5.2</span></span></code></pre></div>
<p>In this vignette we’ll explore the various ways you can stratify the
BBS data in preparation for running the models.</p>
<p>You can use existing, pre-defined stratifications, subset an existing
stratification (e.g., clip the data to your area of interest), or load
your own custom stratification, either using a completely new set of
spatial data, or by modifying the spatial polygons of an existing
strata.</p>
<p>This vignette assumes that the BBS data have already been downloaded
and that you are familiar with the <a href="./bbsBayes2.html">basics of
the bbsBayes2 workflow</a></p>
<div class="section level2">
<h2 id="stratifying-with-built-in-stratifications">Stratifying with built-in stratifications<a class="anchor" aria-label="anchor" href="#stratifying-with-built-in-stratifications"></a>
</h2>
<p>The built-in stratifications are bbs, bbs_usgs, bbs_cws, bcr,
bcr_old, latlong, prov_state.</p>
<ul>
<li>
<code>bbs</code> – New as of Version 1.1.3.1. Intersections of
Political regions X Updated Bird Conservation Regions (Stratification
used by the Canadian Wildlife Service [CWS] for national status
reporting as of 2024)</li>
<li>
<code>bbs_cws</code> – Intersections of Political regions X Bird
Conservation Regions (Stratification formerly used by the Canadian
Wildlife Service [CWS] for national status reporting)</li>
<li>
<code>bbs_usgs</code> – Intersections of Political regions X Bird
Conservation Regions (Stratification used by the United Status
Geological Survey [USGS] for national status reporting)</li>
<li>
<code>bcr</code> – Updated (2025) Bird Conservation Regions,
including the subdivisions of four former northern BCRs (3, 6, 7, and 8)
into the following 10 BCRs: 3C, 3N, 3S, 6N, 6S, 7E, 7W, 7H, 8E and
8W.</li>
<li>
<code>bcr_old</code> – Bird Conservation Regions used prior to
version 1.1.3.1, includes large northern BCRs (3, 6, 7, and 8).
Primarily included for reproducibility.</li>
<li>
<code>prov_state</code> – Political regions only - states,
provinces, and territories</li>
<li>
<code>latlong</code> – Grid-cells of 1 degree of latitude X 1 degree
of longitude, aka “degree-blocks”. These are the original survey design
strata for the BBS. Routes are established at randomized locations
within these degree-blocks.</li>
</ul>
<p>You can visualize these stratifications by looking at the maps
included in bbsBayes2 with <code><a href="../reference/load_map.html">load_map()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/load_map.html">load_map</a></span><span class="op">(</span><span class="st">"bbs"</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">strata_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span>guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/stratification_unnamed-chunk-2-1.png" alt="Map of the new BBS stratification showing the regions that represent spatial intersections of the updated (2025) Bird Conservation Regions with political jurisdictions (Provinces, Territories, States)"></p>
<p>To stratify BBS data, you can use these existing stratifications by
specifying <code>by = "name"</code> in the <code><a href="../reference/stratify.html">stratify()</a></code>
function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stratify.html">stratify</a></span><span class="op">(</span>by <span class="op">=</span> <span class="st">"bbs_usgs"</span>, species <span class="op">=</span> <span class="st">"Mallard"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using 'bbs_usgs' (standard) stratification</span></span>
<span><span class="co">#&gt; Loading BBS data...</span></span>
<span><span class="co">#&gt; Filtering to species Mallard (1320)</span></span>
<span><span class="co">#&gt; Stratifying data...</span></span>
<span><span class="co">#&gt; Preparing strata (ESRI:102008; North_America_Albers_Equal_Area_Conic)...</span></span>
<span><span class="co">#&gt;   Calculating area weights...</span></span>
<span><span class="co">#&gt;   Joining routes to spatial layer...</span></span>
<span><span class="co">#&gt;   Renaming routes...</span></span>
<span><span class="co">#&gt;   Omitting 2,436/127,482 surveys, on 111 unique routes that do not match a stratum.</span></span>
<span><span class="co">#&gt;     To see omitted routes use `return_omitted = TRUE` (see ?stratify)</span></span></code></pre></div>
<div class="section level3">
<h3 id="the-latlong-stratification---special-note">The latlong stratification - special note<a class="anchor" aria-label="anchor" href="#the-latlong-stratification---special-note"></a>
</h3>
<p>The latlong stratification <code>by = "latlong"</code> is the
finest-scale stratification built into the package, and so it divides
the BBS data into many more strata-units than other stratifications.
Therefore, you may wish to adjust the minimum data inclusion criteria
when preparing the data. Specifically, setting
<code>min_n_routes = 1</code> ensures that every grid-cell with at least
one BBS route can be included. There are many degree-blocks that have
only one route, as this is the original sampling design goal of the BBS
(at least one route within each degree-block).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stratify.html">stratify</a></span><span class="op">(</span>by <span class="op">=</span> <span class="st">"latlong"</span>, species <span class="op">=</span> <span class="st">"Mallard"</span>, use_map <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using 'latlong' (standard) stratification</span></span>
<span><span class="co">#&gt; Loading BBS data...</span></span>
<span><span class="co">#&gt; Filtering to species Mallard (1320)</span></span>
<span><span class="co">#&gt; Stratifying data...</span></span>
<span><span class="co">#&gt;   Renaming routes...</span></span>
<span><span class="co">#&gt;   Omitting 115/127,482 surveys, on 7 unique routes that do not match a stratum.</span></span>
<span><span class="co">#&gt;     To see omitted routes use `return_omitted = TRUE` (see ?stratify)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_data</a></span><span class="op">(</span><span class="va">s</span>, min_n_routes <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="custom-stratifications">Custom stratifications<a class="anchor" aria-label="anchor" href="#custom-stratifications"></a>
</h2>
<p>bbsBayes2 can stratify the BBS data using any polygon map as
input.</p>
<div class="section level3">
<h3 id="load-a-custom-stratification-map">Load a custom stratification map<a class="anchor" aria-label="anchor" href="#load-a-custom-stratification-map"></a>
</h3>
<p>To define a completely different stratification, you’ll need to
provide a spatial data object with polygons defining your strata.</p>
<p>In our example we’ll use WBPHS stratum boundaries. This is available
from available from the US Fish and Wildlife Service Catalogue: <a href="https://ecos.fws.gov/ServCat/Reference/Profile/142628" class="external-link uri">https://ecos.fws.gov/ServCat/Reference/Profile/142628</a></p>
<p>To run this locally, download the file manually and unzip the
shapefile contents into subdirectory of your working directory called
<em>output</em>.</p>
<p>To use this file in bbsBayes2, we need to load it as an sf object
using the sf package.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="st">"output/WBPHS_stratum_boundaries.shp"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">map</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">stratum</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span>guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/stratification_unnamed-chunk-5-1.png" alt="Map of the strata used in the Waterfowl Breeding Population and Habitat Surveys">
### Identify the strata names</p>
<p>We see that it has one column that reflects the stratum names. First
we’ll rename this column to <code>strata_name</code>, and mutate it into
a character value, so that the <code><a href="../reference/stratify.html">stratify()</a></code> function knows
what attribute includes the names that define each stratum.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="va">map</span>, strata_name <span class="op">=</span> <span class="va">stratum</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>strata_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">strata_name</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="stratify-the-data">Stratify the data<a class="anchor" aria-label="anchor" href="#stratify-the-data"></a>
</h3>
<p>Now we have the spatial data and relevant information to pass to
<code><a href="../reference/stratify.html">stratify()</a></code>.</p>
<p>When using a custom stratification, the <code>by</code> argument is
just a user-defined arbitrary name to document which stratification was
used. This name gets passed into the meta data of the following steps
and the final fitted model. Let’s use something informative, but short
(although there’s no limit). We also need to give the function our
map.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stratify.html">stratify</a></span><span class="op">(</span>by <span class="op">=</span> <span class="st">"WBPHS"</span>, species <span class="op">=</span> <span class="st">"Mallard"</span>, strata_custom <span class="op">=</span> <span class="va">map</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using 'wbphs' (custom) stratification</span></span>
<span><span class="co">#&gt; Loading BBS data...</span></span>
<span><span class="co">#&gt; Filtering to species Mallard (1320)</span></span>
<span><span class="co">#&gt; Stratifying data...</span></span>
<span><span class="co">#&gt; Preparing strata (EPSG:4326; WGS 84)...</span></span>
<span><span class="co">#&gt;   Summarizing strata...</span></span>
<span><span class="co">#&gt;   Calculating area weights...</span></span>
<span><span class="co">#&gt;   Joining routes to spatial layer...</span></span>
<span><span class="co">#&gt;   Renaming routes...</span></span>
<span><span class="co">#&gt;   Omitting 106,608/127,482 surveys, on 3,783 unique routes that do not match a stratum.</span></span>
<span><span class="co">#&gt;     To see omitted routes use `return_omitted = TRUE` (see ?stratify)</span></span></code></pre></div>
<blockquote>
<p>Note that strata names are automatically put into lower case for
consistency.</p>
</blockquote>
<p>We can take a quick look at the output, by looking at the meta data
and routes contained therein.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span><span class="op">[[</span><span class="st">"meta_data"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; $stratify_by</span></span>
<span><span class="co">#&gt; [1] "wbphs"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $stratify_type</span></span>
<span><span class="co">#&gt; [1] "custom"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $species</span></span>
<span><span class="co">#&gt; [1] "Mallard"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sp_aou</span></span>
<span><span class="co">#&gt; [1] 1320</span></span>
<span></span>
<span><span class="va">s</span><span class="op">[[</span><span class="st">"routes_strata"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; # A tibble: 20,874 × 34</span></span>
<span><span class="co">#&gt;    strata_name country_num state_num route route_name active   bcr route_type_id route_type_detail_id</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;                &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 3                   840         3 3-4   BIRCH LAKE      1     4             1                    1</span></span>
<span><span class="co">#&gt;  2 3                   840         3 3-4   BIRCH LAKE      1     4             1                    1</span></span>
<span><span class="co">#&gt;  3 3                   840         3 3-4   BIRCH LAKE      1     4             1                    1</span></span>
<span><span class="co">#&gt;  4 3                   840         3 3-4   BIRCH LAKE      1     4             1                    1</span></span>
<span><span class="co">#&gt;  5 3                   840         3 3-4   BIRCH LAKE      1     4             1                    1</span></span>
<span><span class="co">#&gt;  6 3                   840         3 3-4   BIRCH LAKE      1     4             1                    1</span></span>
<span><span class="co">#&gt;  7 3                   840         3 3-4   BIRCH LAKE      1     4             1                    1</span></span>
<span><span class="co">#&gt;  8 3                   840         3 3-4   BIRCH LAKE      1     4             1                    1</span></span>
<span><span class="co">#&gt;  9 3                   840         3 3-4   BIRCH LAKE      1     4             1                    1</span></span>
<span><span class="co">#&gt; 10 3                   840         3 3-4   BIRCH LAKE      1     4             1                    1</span></span>
<span><span class="co">#&gt; # ℹ 20,864 more rows</span></span>
<span><span class="co">#&gt; # ℹ 25 more variables: route_data_id &lt;dbl&gt;, rpid &lt;dbl&gt;, year &lt;dbl&gt;, month &lt;dbl&gt;, day &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   obs_n &lt;dbl&gt;, total_spp &lt;dbl&gt;, start_temp &lt;dbl&gt;, end_temp &lt;dbl&gt;, temp_scale &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   start_wind &lt;dbl&gt;, end_wind &lt;dbl&gt;, start_sky &lt;dbl&gt;, end_sky &lt;dbl&gt;, start_time &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   end_time &lt;dbl&gt;, assistant &lt;dbl&gt;, quality_current_id &lt;dbl&gt;, run_type &lt;dbl&gt;, state &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   st_abrev &lt;chr&gt;, country &lt;chr&gt;, longitude &lt;dbl&gt;, latitude &lt;dbl&gt;, area_sq_km &lt;dbl&gt;</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualise-the-new-strata-and-data">Visualise the new strata and data<a class="anchor" aria-label="anchor" href="#visualise-the-new-strata-and-data"></a>
</h3>
<p>To get a different look we can also plot this data on top of our map
using ggplot2. Note that we use <code><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor()</a></code> to ensure the
strata names are categorical.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rts</span> <span class="op">&lt;-</span> <span class="va">s</span><span class="op">[[</span><span class="st">"routes_strata"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">map</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">strata_name</span><span class="op">)</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rts</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">strata_name</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span>aesthetics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"colour"</span>, <span class="st">"fill"</span><span class="op">)</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/stratification_unnamed-chunk-9-1.png" alt="map showing the strata in our custom stratification"></p>
</div>
<div class="section level3">
<h3 id="omitted-bbs-routes">Omitted BBS routes<a class="anchor" aria-label="anchor" href="#omitted-bbs-routes"></a>
</h3>
<p>Based on the message we received during stratification
(<code>Omitting...</code>) and this map, it looks as if our custom
stratification is excluding some BBS data (i.e., routes with starting
locations that are not overlapped by the strata map). This makes sense
because the WBPHS survey area is much smaller than the region covered by
the BBS. However, let’s confirm that the excluded routes are the ones we
expect.</p>
<p>We can re-run the stratification with
<code>return_omitted = TRUE</code> which will attach a data frame of
omitted strata to the output.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stratify.html">stratify</a></span><span class="op">(</span>by <span class="op">=</span> <span class="st">"WBPHS"</span>, species <span class="op">=</span> <span class="st">"Mallard"</span>, strata_custom <span class="op">=</span> <span class="va">map</span>,</span>
<span>              return_omitted <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using 'wbphs' (custom) stratification</span></span>
<span><span class="co">#&gt; Loading BBS data...</span></span>
<span><span class="co">#&gt; Filtering to species Mallard (1320)</span></span>
<span><span class="co">#&gt; Stratifying data...</span></span>
<span><span class="co">#&gt; Preparing strata (EPSG:4326; WGS 84)...</span></span>
<span><span class="co">#&gt;   Summarizing strata...</span></span>
<span><span class="co">#&gt;   Calculating area weights...</span></span>
<span><span class="co">#&gt;   Joining routes to spatial layer...</span></span>
<span><span class="co">#&gt;   Renaming routes...</span></span>
<span><span class="co">#&gt;   Omitting 106,608/127,482 surveys, on 3,783 unique routes that do not match a stratum.</span></span>
<span><span class="co">#&gt;     Returning omitted routes.</span></span>
<span><span class="va">s</span><span class="op">[[</span><span class="st">"routes_omitted"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; # A tibble: 106,608 × 11</span></span>
<span><span class="co">#&gt;     year strata_name country state   route route_name latitude longitude   bcr   obs_n total_spp</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1  1967 &lt;NA&gt;        US      ALABAMA 2-1   ST FLORIAN     34.9     -87.6    27 1140018        56</span></span>
<span><span class="co">#&gt;  2  1969 &lt;NA&gt;        US      ALABAMA 2-1   ST FLORIAN     34.9     -87.6    27  990062        52</span></span>
<span><span class="co">#&gt;  3  1970 &lt;NA&gt;        US      ALABAMA 2-1   ST FLORIAN     34.9     -87.6    27  990062        52</span></span>
<span><span class="co">#&gt;  4  1971 &lt;NA&gt;        US      ALABAMA 2-1   ST FLORIAN     34.9     -87.6    27  990062        56</span></span>
<span><span class="co">#&gt;  5  1972 &lt;NA&gt;        US      ALABAMA 2-1   ST FLORIAN     34.9     -87.6    27  990062        54</span></span>
<span><span class="co">#&gt;  6  1973 &lt;NA&gt;        US      ALABAMA 2-1   ST FLORIAN     34.9     -87.6    27 1060057        52</span></span>
<span><span class="co">#&gt;  7  1974 &lt;NA&gt;        US      ALABAMA 2-1   ST FLORIAN     34.9     -87.6    27 1060057        55</span></span>
<span><span class="co">#&gt;  8  1975 &lt;NA&gt;        US      ALABAMA 2-1   ST FLORIAN     34.9     -87.6    27 1060057        59</span></span>
<span><span class="co">#&gt;  9  1976 &lt;NA&gt;        US      ALABAMA 2-1   ST FLORIAN     34.9     -87.6    27 1060057        56</span></span>
<span><span class="co">#&gt; 10  1977 &lt;NA&gt;        US      ALABAMA 2-1   ST FLORIAN     34.9     -87.6    27 1060057        51</span></span>
<span><span class="co">#&gt; # ℹ 106,598 more rows</span></span></code></pre></div>
<p>Let’s take a look.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">omitted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">s</span><span class="op">[[</span><span class="st">"routes_omitted"</span><span class="op">]</span><span class="op">]</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>,</span>
<span>                    crs<span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">map</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">strata_name</span><span class="op">)</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rts</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">strata_name</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">omitted</span>, size <span class="op">=</span> <span class="fl">0.75</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span>aesthetics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"colour"</span>, <span class="st">"fill"</span><span class="op">)</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/stratification_unnamed-chunk-11-1.png" alt="map showing BBS route starting locations that are inside and outside of the custom stratification"></p>
<p>The map shows that most of the omitted routes are routes that are
clearly outside of our desired stratification. However, it also shows
that there are some BBS route start-points that are just outside of the
strata (e.g., some routes in Nova Scotia and Alaska). The user can
decide what to do with these sorts of minor overlap issues. For example,
buffering the original stratification map might make sense in some
situations. For now, we will trust our custom strata map and retain only
the BBS routes with start locations inside our strata polygons.</p>
</div>
</div>
<div class="section level2">
<h2 id="fitting-the-model">Fitting the model<a class="anchor" aria-label="anchor" href="#fitting-the-model"></a>
</h2>
<p>To fit the model, we follow the standard workflow using our
stratified data.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_data</a></span><span class="op">(</span><span class="va">s</span>,</span>
<span>                  min_year <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>                  max_year <span class="op">=</span> <span class="fl">2021</span><span class="op">)</span> <span class="co">#subset a shorter time-span to speed model-fit</span></span>
<span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_spatial.html">prepare_spatial</a></span><span class="op">(</span><span class="va">p</span>,<span class="va">map</span><span class="op">)</span></span>
<span><span class="co">#&gt; Preparing spatial data...</span></span>
<span><span class="co">#&gt; Supplied strata_map is in a geographic projection. Transforming coordinate reference system to a projected and equal area crs to facilitate mapping and neighbourhood relationships. This will not affect the relationship between strata and the BBS data, only ensures that neighbours are consistently defined and easily mapped.</span></span>
<span><span class="co">#&gt;     Summarizing polygons by strata...</span></span>
<span><span class="co">#&gt; Identifying neighbours (non-Voronoi method)...</span></span>
<span><span class="co">#&gt; Linking islands (isolated groups of nodes)...</span></span>
<span><span class="co">#&gt;     Islands found (5). Linking by distance between centroids...</span></span>
<span><span class="co">#&gt;     Islands found (4). Linking by distance between centroids...</span></span>
<span><span class="co">#&gt;     Islands found (3). Linking by distance between centroids...</span></span>
<span><span class="co">#&gt;     Islands found (2). Linking by distance between centroids...</span></span>
<span><span class="co">#&gt;     Islands found (1). Linking by distance between centroids...</span></span>
<span><span class="co">#&gt; Formating neighbourhood matrices...</span></span>
<span><span class="co">#&gt; Plotting neighbourhood matrices...</span></span>
<span><span class="va">mp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_model.html">prepare_model</a></span><span class="op">(</span><span class="va">sp</span>,model <span class="op">=</span> <span class="st">"first_diff"</span>,</span>
<span>                   model_variant <span class="op">=</span> <span class="st">"spatial"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_model.html">run_model</a></span><span class="op">(</span><span class="va">mp</span>,</span>
<span>               iter_warmup <span class="op">=</span> <span class="fl">500</span>,</span>
<span>               iter_sampling <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="predictions-from-the-model-using-the-custom-stratification">Predictions from the model using the custom stratification<a class="anchor" aria-label="anchor" href="#predictions-from-the-model-using-the-custom-stratification"></a>
</h3>
<p>Now we can start to look at the indices and trends related to our
model.</p>
<p>We can apply the <code><a href="../reference/generate_indices.html">generate_indices()</a></code> and
<code><a href="../reference/generate_trends.html">generate_trends()</a></code> functions to the output from our model,
the same as we would with the built-in stratifications.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_indices.html">generate_indices</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="co">#&gt; Processing region continent</span></span>
<span><span class="co">#&gt; Processing region stratum</span></span>
<span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_trends.html">generate_trends</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span></code></pre></div>
<p>And with one additional argument, we can also use the
<code><a href="../reference/plot_map.html">plot_map()</a></code> function.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trend_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_map.html">plot_map</a></span><span class="op">(</span><span class="va">t</span>, strata_custom <span class="op">=</span> <span class="va">map</span><span class="op">)</span></span>
<span><span class="va">trend_map</span></span></code></pre></div>
<p><img src="figures/stratification_unnamed-chunk-16-1.png"></p>
</div>
</div>
<div class="section level2">
<h2 id="generating-state-and-province-predictions-from-a-custom-stratification">Generating state and province predictions from a custom
stratification<a class="anchor" aria-label="anchor" href="#generating-state-and-province-predictions-from-a-custom-stratification"></a>
</h2>
<p>A useful feature of the hierarchical Bayesian models for the BBS is
the ability to generate formal estimates of indices (annual relative
abundance) and trends (rates of population change) for any composite
region. <em>Formal estimates</em> meaning we can estimate the full
posterior distribution, including a point estimate and its associated
uncertainty (credible limits). These composite regions can be defined
based on any combination of the underlying strata used to fit the model.
For example, using any custom stratification, we can generate estimates
for political jurisdictions (countries, states, provinces), as long as
we can comfortably designate each of the strata to one of these
jurisdictions.</p>
<p>By default, <code><a href="../reference/generate_indices.html">generate_indices()</a></code> creates indices at two
levels “continent” (the combination of all strata used in the analysis)
and “stratum” (estimates for individual strata). For the two
<em>bbs</em> stratifications (“bbs_usgs” and “bbs_cws”), we can also add
“prov_state”, “bcr”, “bcr_by_country” (where appropriate). For any
custom stratification, we can also add the political jurisdictions
and/or create our own regional divisions and provide them as a
<code>regions_index</code> data frame.</p>
<p>For example, let’s imagine we would like to calculate regional
indices for each stratum, country, province/state, as well as for a
custom division of eastern and western regions.</p>
<p>First we’ll need to tell the function which strata belong to which
province or state, and then which belong to the ‘east’ and which to the
’west.</p>
<p>We’ll start by using a helper function
<code><a href="../reference/assign_prov_state.html">assign_prov_state()</a></code>. This function takes a map of strata
and assigns each strata to a province or state depending on the amount
of overlap. By default it will warn if the amount of overlap is less
than 75%, but in this case, we will lower that cutoff to 60%. The plot
gives us a chance to make a quick assessment of whether we’re happy with
how the various strata have been assigned.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rindex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assign_prov_state.html">assign_prov_state</a></span><span class="op">(</span><span class="va">map</span>, min_overlap <span class="op">=</span> <span class="fl">0.6</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/stratification_unnamed-chunk-17-1.png"></p>
<p>Next we’ll define the east/west divide by hand. If we plot the strata
by name, we can pick out which are eastern and which western.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">rindex</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/load_map.html">load_map</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"North America"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">strata_name</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not give correct results for</span></span>
<span><span class="co">#&gt; longitude/latitude data</span></span></code></pre></div>
<p><img src="figures/stratification_unnamed-chunk-18-1.png"></p>
<p>The western and eastern strata seem to be split numerically, such
that the western strata have numbers lower than 50 or greater than 74,
eastern strata have numbers in between. So we’ll add a column to the
<code>rindex</code> dataframe with “east” and “west” character names to
group the strata.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rindex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>  <span class="va">rindex</span>,</span>
<span>  east_west <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">strata_name</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">50</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">strata_name</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">74</span>,</span>
<span>                      <span class="st">"west"</span>,</span>
<span>                      <span class="st">"east"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>And now double check that we correctly grouped the strata!</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rindex</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="../reference/load_map.html">load_map</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"North America"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rindex</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">east_west</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/stratification_unnamed-chunk-20-1.png"></p>
<p>Then supply the <code>rindex</code> object to the
<code>regions_index</code> argument of the
<code><a href="../reference/generate_indices.html">generate_indices()</a></code> function and include the relevant column
names from the object as <code>regions</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_indices.html">generate_indices</a></span><span class="op">(</span></span>
<span>  <span class="va">m</span>,</span>
<span>  regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stratum"</span>, <span class="st">"country"</span>, <span class="st">"prov_state"</span>, <span class="st">"east_west"</span><span class="op">)</span>,</span>
<span>  regions_index <span class="op">=</span> <span class="va">rindex</span><span class="op">)</span></span>
<span><span class="co">#&gt; Processing region stratum</span></span>
<span><span class="co">#&gt; Processing region country</span></span>
<span><span class="co">#&gt; Processing region prov_state</span></span>
<span><span class="co">#&gt; Processing region east_west</span></span>
<span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_trends.html">generate_trends</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span></code></pre></div>
<p>We can plot the population trajectories for each of these regions
with <code><a href="../reference/plot_indices.html">plot_indices()</a></code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_indices.html">plot_indices</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "1"                        "14"                       "17"                      </span></span>
<span><span class="co">#&gt;  [4] "18"                       "2"                        "22"                      </span></span>
<span><span class="co">#&gt;  [7] "24"                       "26"                       "27"                      </span></span>
<span><span class="co">#&gt; [10] "28"                       "29"                       "30"                      </span></span>
<span><span class="co">#&gt; [13] "31"                       "32"                       "33"                      </span></span>
<span><span class="co">#&gt; [16] "34"                       "35"                       "37"                      </span></span>
<span><span class="co">#&gt; [19] "38"                       "39"                       "40"                      </span></span>
<span><span class="co">#&gt; [22] "41"                       "42"                       "43"                      </span></span>
<span><span class="co">#&gt; [25] "44"                       "45"                       "46"                      </span></span>
<span><span class="co">#&gt; [28] "47"                       "48"                       "49"                      </span></span>
<span><span class="co">#&gt; [31] "50"                       "51"                       "52"                      </span></span>
<span><span class="co">#&gt; [34] "53"                       "54"                       "55"                      </span></span>
<span><span class="co">#&gt; [37] "56"                       "62"                       "63"                      </span></span>
<span><span class="co">#&gt; [40] "64"                       "66"                       "68"                      </span></span>
<span><span class="co">#&gt; [43] "72"                       "75"                       "76"                      </span></span>
<span><span class="co">#&gt; [46] "77"                       "Canada"                   "United_States_of_America"</span></span>
<span><span class="co">#&gt; [49] "AB"                       "AK"                       "MB"                      </span></span>
<span><span class="co">#&gt; [52] "ME"                       "MT"                       "NB"                      </span></span>
<span><span class="co">#&gt; [55] "ND"                       "NL"                       "NS"                      </span></span>
<span><span class="co">#&gt; [58] "NT"                       "NY"                       "ON"                      </span></span>
<span><span class="co">#&gt; [61] "QC"                       "SD"                       "SK"                      </span></span>
<span><span class="co">#&gt; [64] "east"                     "west"</span></span>
<span></span>
<span><span class="va">p</span><span class="op">[[</span><span class="st">"east"</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">p</span><span class="op">[[</span><span class="st">"west"</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="figures/stratification_unnamed-chunk-22-1.png"></p>
<p>Finally we can even create geofaceted plots (which is only possible
in our case because we assigned our strata to Provinces and States and
calculated indices for these regions). These geofacet plots can be
useful for visualizing the population trajectories of species with broad
ranges across many states and provinces.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_geofacet.html">plot_geofacet</a></span><span class="op">(</span><span class="va">i</span>, trends <span class="op">=</span> <span class="va">t</span>, multiple <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/stratification_unnamed-chunk-23-1.png"></p>
</div>
<div class="section level2">
<h2 id="subsetting-an-existing-stratification">Subsetting an existing stratification<a class="anchor" aria-label="anchor" href="#subsetting-an-existing-stratification"></a>
</h2>
<p>In general, it is often useful to use all of the data for a given
species, even if you’re only interested in trends for a portion of the
species’ range (estimates of observer effects are informed by all of the
data in the analysis). However, there may be situations where the focus
of your study is limited to a particular region. For example what if you
want to use one of the standard stratifications, but you only want the
analysis to be influenced by data from one region, say only Canadian
data?</p>
<p>In this case you can subset the BBS CWS stratification to only
Canadian regions, and use that subset of regions as a custom
stratification in the <code><a href="../reference/stratify.html">stratify()</a></code> function.</p>
<p>In addition to maps, stratifications are available as data frames in
the <code>bbs_strata</code> object.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">bbs_strata</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "bbs"        "bbs_usgs"   "bbs_cws"    "bcr"        "bcr_old"    "latlong"    "prov_state"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bbs_strata</span><span class="op">[[</span><span class="st">"bbs_cws"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 7</span></span>
<span><span class="co">#&gt;   strata_name area_sq_km country country_code prov_state   bcr bcr_by_country</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;            &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;         </span></span>
<span><span class="co">#&gt; 1 CA-AB-10        52565. Canada  CA           AB            10 Canada-BCR_10 </span></span>
<span><span class="co">#&gt; 2 CA-AB-11       149352. Canada  CA           AB            11 Canada-BCR_11 </span></span>
<span><span class="co">#&gt; 3 CA-AB-6        445135. Canada  CA           AB             6 Canada-BCR_6  </span></span>
<span><span class="co">#&gt; 4 CA-AB-8          6987. Canada  CA           AB             8 Canada-BCR_8  </span></span>
<span><span class="co">#&gt; 5 CA-BC-10       383006. Canada  CA           BC            10 Canada-BCR_10 </span></span>
<span><span class="co">#&gt; 6 CA-BC-4        193180. Canada  CA           BC             4 Canada-BCR_4</span></span></code></pre></div>
<p>We can now modify and use this data frame as we like.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_cws</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">bbs_strata</span><span class="op">[[</span><span class="st">"bbs_cws"</span><span class="op">]</span><span class="op">]</span>, <span class="va">country</span> <span class="op">==</span> <span class="st">"Canada"</span><span class="op">)</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stratify.html">stratify</a></span><span class="op">(</span>by <span class="op">=</span> <span class="st">"bbs_cws"</span>, species <span class="op">=</span> <span class="st">"Mallard"</span>, strata_custom <span class="op">=</span> <span class="va">my_cws</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using 'bbs_cws' (subset) stratification</span></span>
<span><span class="co">#&gt; Loading BBS data...</span></span>
<span><span class="co">#&gt; Filtering to species Mallard (1320)</span></span>
<span><span class="co">#&gt; Stratifying data...</span></span>
<span><span class="co">#&gt; Preparing strata (ESRI:102008; North_America_Albers_Equal_Area_Conic)...</span></span>
<span><span class="co">#&gt;   Calculating area weights...</span></span>
<span><span class="co">#&gt;   Joining routes to spatial layer...</span></span>
<span><span class="co">#&gt;   Renaming routes...</span></span>
<span><span class="co">#&gt; Error in UseMethod("semi_join"): no applicable method for 'semi_join' applied to an object of class "list"</span></span></code></pre></div>
<p>Note that the stratification is now “bbs_cws” and “subset”</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span><span class="op">[[</span><span class="st">"meta_data"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; $stratify_by</span></span>
<span><span class="co">#&gt; [1] "wbphs"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $stratify_type</span></span>
<span><span class="co">#&gt; [1] "custom"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $species</span></span>
<span><span class="co">#&gt; [1] "Mallard"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sp_aou</span></span>
<span><span class="co">#&gt; [1] 1320</span></span></code></pre></div>
<p>We can see the strata included by looking at the
<code>meta_strata</code></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">s</span><span class="op">[[</span><span class="st">"meta_strata"</span><span class="op">]</span><span class="op">]</span>, n <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 63 × 1</span></span>
<span><span class="co">#&gt;    strata_name</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;      </span></span>
<span><span class="co">#&gt;  1 3          </span></span>
<span><span class="co">#&gt;  2 14         </span></span>
<span><span class="co">#&gt;  3 8          </span></span>
<span><span class="co">#&gt;  4 1          </span></span>
<span><span class="co">#&gt;  5 2          </span></span>
<span><span class="co">#&gt;  6 1          </span></span>
<span><span class="co">#&gt;  7 15         </span></span>
<span><span class="co">#&gt;  8 17         </span></span>
<span><span class="co">#&gt;  9 18         </span></span>
<span><span class="co">#&gt; 10 77         </span></span>
<span><span class="co">#&gt; 11 23         </span></span>
<span><span class="co">#&gt; 12 67         </span></span>
<span><span class="co">#&gt; 13 76         </span></span>
<span><span class="co">#&gt; 14 69         </span></span>
<span><span class="co">#&gt; 15 66         </span></span>
<span><span class="co">#&gt; 16 24         </span></span>
<span><span class="co">#&gt; 17 70         </span></span>
<span><span class="co">#&gt; 18 75         </span></span>
<span><span class="co">#&gt; 19 22         </span></span>
<span><span class="co">#&gt; 20 26         </span></span>
<span><span class="co">#&gt; 21 71         </span></span>
<span><span class="co">#&gt; 22 30         </span></span>
<span><span class="co">#&gt; 23 50         </span></span>
<span><span class="co">#&gt; 24 25         </span></span>
<span><span class="co">#&gt; 25 70         </span></span>
<span><span class="co">#&gt; 26 31         </span></span>
<span><span class="co">#&gt; 27 27         </span></span>
<span><span class="co">#&gt; 28 68         </span></span>
<span><span class="co">#&gt; 29 72         </span></span>
<span><span class="co">#&gt; 30 36         </span></span>
<span><span class="co">#&gt; 31 32         </span></span>
<span><span class="co">#&gt; 32 28         </span></span>
<span><span class="co">#&gt; 33 64         </span></span>
<span><span class="co">#&gt; 34 37         </span></span>
<span><span class="co">#&gt; 35 34         </span></span>
<span><span class="co">#&gt; 36 33         </span></span>
<span><span class="co">#&gt; 37 63         </span></span>
<span><span class="co">#&gt; 38 29         </span></span>
<span><span class="co">#&gt; 39 65         </span></span>
<span><span class="co">#&gt; 40 51         </span></span>
<span><span class="co">#&gt; 41 40         </span></span>
<span><span class="co">#&gt; 42 56         </span></span>
<span><span class="co">#&gt; 43 35         </span></span>
<span><span class="co">#&gt; 44 62         </span></span>
<span><span class="co">#&gt; 45 41         </span></span>
<span><span class="co">#&gt; 46 38         </span></span>
<span><span class="co">#&gt; 47 39         </span></span>
<span><span class="co">#&gt; 48 0          </span></span>
<span><span class="co">#&gt; 49 45         </span></span>
<span><span class="co">#&gt; 50 42         </span></span>
<span><span class="co">#&gt; 51 47         </span></span>
<span><span class="co">#&gt; 52 43         </span></span>
<span><span class="co">#&gt; 53 0          </span></span>
<span><span class="co">#&gt; 54 0          </span></span>
<span><span class="co">#&gt; 55 46         </span></span>
<span><span class="co">#&gt; 56 52         </span></span>
<span><span class="co">#&gt; 57 53         </span></span>
<span><span class="co">#&gt; 58 55         </span></span>
<span><span class="co">#&gt; 59 0          </span></span>
<span><span class="co">#&gt; 60 44         </span></span>
<span><span class="co">#&gt; 61 54         </span></span>
<span><span class="co">#&gt; 62 48         </span></span>
<span><span class="co">#&gt; 63 49</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="modifying-existing-bbs-maps">Modifying existing BBS maps<a class="anchor" aria-label="anchor" href="#modifying-existing-bbs-maps"></a>
</h2>
<p>Stratify by custom stratification, using sf map object. For example,
let’s look at an east/west divide of southern Canada with BBS CWS
strata.</p>
<p>First we’ll start with the CWS BBS data</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_map.html">load_map</a></span><span class="op">(</span><span class="st">"bbs_cws"</span><span class="op">)</span></span></code></pre></div>
<p>We’ll modify this by first looking only at provinces (omitting the
northern territories), transforming to the GPS CRS (4326), and ensuring
the resulting polygons are valid.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_map</span> <span class="op">&lt;-</span> <span class="va">map</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">country_code</span> <span class="op">==</span> <span class="st">"CA"</span>, <span class="op">!</span><span class="va">prov_state</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NT"</span>, <span class="st">"NU"</span>, <span class="st">"YT"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html" class="external-link">st_make_valid</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Now we can crop this map to make a western and an eastern portion,
defined by longitude and latitude (which is why we first transformed to
the GPS CRS).</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">west</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html" class="external-link">st_crop</a></span><span class="op">(</span><span class="va">new_map</span>, xmin <span class="op">=</span> <span class="op">-</span><span class="fl">140</span>, ymin <span class="op">=</span> <span class="fl">42</span>, xmax <span class="op">=</span> <span class="op">-</span><span class="fl">95</span>, ymax <span class="op">=</span> <span class="fl">68</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>strata_name <span class="op">=</span> <span class="st">"west"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: attribute variables are assumed to be spatially constant throughout all geometries</span></span>
<span><span class="va">east</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html" class="external-link">st_crop</a></span><span class="op">(</span><span class="va">new_map</span>, xmin <span class="op">=</span> <span class="op">-</span><span class="fl">95</span>, ymin <span class="op">=</span> <span class="fl">42</span>, xmax <span class="op">=</span> <span class="op">-</span><span class="fl">52</span>, ymax <span class="op">=</span> <span class="fl">68</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>strata_name <span class="op">=</span> <span class="st">"east"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: attribute variables are assumed to be spatially constant throughout all geometries</span></span></code></pre></div>
<p>Now we’ll bind these together and transform back to the original
CRS</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_strata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">west</span>, <span class="va">east</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">map</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">new_strata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">strata_name</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/stratification_unnamed-chunk-31-1.png"></p>
<p>Looks good! Let’s use it in our stratification and take a look at the
points afterwards to ensure they’ve been categorized appropriately.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stratify.html">stratify</a></span><span class="op">(</span>by <span class="op">=</span> <span class="st">"canada_ew"</span>, species <span class="op">=</span> <span class="st">"Mallard"</span>,</span>
<span>              strata_custom <span class="op">=</span> <span class="va">new_strata</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using 'canada_ew' (custom) stratification</span></span>
<span><span class="co">#&gt; Loading BBS data...</span></span>
<span><span class="co">#&gt; Filtering to species Mallard (1320)</span></span>
<span><span class="co">#&gt; Stratifying data...</span></span>
<span><span class="co">#&gt; Preparing strata (ESRI:102008; North_America_Albers_Equal_Area_Conic)...</span></span>
<span><span class="co">#&gt;   Summarizing strata...</span></span>
<span><span class="co">#&gt;   Calculating area weights...</span></span>
<span><span class="co">#&gt;   Joining routes to spatial layer...</span></span>
<span><span class="co">#&gt;   Renaming routes...</span></span>
<span><span class="co">#&gt;   Omitting 110,107/127,482 surveys, on 3,812 unique routes that do not match a stratum.</span></span>
<span><span class="co">#&gt;     To see omitted routes use `return_omitted = TRUE` (see ?stratify)</span></span>
<span></span>
<span><span class="va">s</span><span class="op">$</span><span class="va">meta_data</span></span>
<span><span class="co">#&gt; $stratify_by</span></span>
<span><span class="co">#&gt; [1] "canada_ew"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $stratify_type</span></span>
<span><span class="co">#&gt; [1] "custom"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $species</span></span>
<span><span class="co">#&gt; [1] "Mallard"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sp_aou</span></span>
<span><span class="co">#&gt; [1] 1320</span></span>
<span><span class="va">routes</span> <span class="op">&lt;-</span> <span class="va">s</span><span class="op">$</span><span class="va">routes_strata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">new_strata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">strata_name</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">routes</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="va">strata_name</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/stratification_unnamed-chunk-32-1.png"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Brandon P.M. Edwards, Adam C. Smith, Steffi LaZerte.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
