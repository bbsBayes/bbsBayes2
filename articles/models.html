<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Models in bbsBayes2 • bbsBayes2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Models in bbsBayes2">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bbsBayes2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/bbsBayes2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bbsBayes/bbsBayes2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Models in bbsBayes2</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bbsBayes/bbsBayes2/blob/main/vignettes/articles/models.Rmd" class="external-link"><code>vignettes/articles/models.Rmd</code></a></small>
      <div class="d-none name"><code>models.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bbsBayes/bbsBayes2" class="external-link">bbsBayes2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span></code></pre></div>
<p>There are 9 types of models that can be run with bbsBayes2. For a
quick overview you can access the <code>bbs_models</code> data
frame.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bbs_models</span></span>
<span><span class="co">#&gt; # A tibble: 9 × 3</span></span>
<span><span class="co">#&gt;   model      variant file                          </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;                         </span></span>
<span><span class="co">#&gt; 1 first_diff nonhier first_diff_nonhier_bbs_CV.stan</span></span>
<span><span class="co">#&gt; 2 first_diff hier    first_diff_hier_bbs_CV.stan   </span></span>
<span><span class="co">#&gt; 3 first_diff spatial first_diff_spatial_bbs_CV.stan</span></span>
<span><span class="co">#&gt; 4 gam        hier    gam_hier_bbs_CV.stan          </span></span>
<span><span class="co">#&gt; 5 gam        spatial gam_spatial_bbs_CV.stan       </span></span>
<span><span class="co">#&gt; 6 gamye      hier    gamye_hier_bbs_CV.stan        </span></span>
<span><span class="co">#&gt; 7 gamye      spatial gamye_spatial_bbs_CV.stan     </span></span>
<span><span class="co">#&gt; 8 slope      hier    slope_hier_bbs_CV.stan        </span></span>
<span><span class="co">#&gt; 9 slope      spatial slope_spatial_bbs_CV.stan</span></span></code></pre></div>
<p>More specifically, there are four models that each have two variants:
<code>variant = "hier"</code> and <code>variant = "spatial"</code>. With
the exception of the first-difference model, which has an additional
non-hierarchical variant <code>variant = "nonhier"</code>.</p>
<div class="section level2">
<h2 id="the-models">The models<a class="anchor" aria-label="anchor" href="#the-models"></a>
</h2>
<p>The four models differ in the way they estimate the time-series
components.</p>
<div class="section level3">
<h3 id="first-difference-models">1. First Difference Models<a class="anchor" aria-label="anchor" href="#first-difference-models"></a>
</h3>
<p>A first-difference model considers the time-series as a random-walk
forward and backwards in time from the mid-year of the time-series, so
that the first-differences of the sequence of year-effects are random
effects with mean = 0 and an estimated variance. The non-hierarchical
variant of this model model has been described in <a href="https://doi.org/10.1650/CONDOR-17-1.1" class="external-link">Link et al., 2017</a> the
hierarchical and spatial variants are described in <a href="https://doi.org/10.1093/ornithapp/duad056" class="external-link">Smith et al.,
2024</a>.</p>
</div>
<div class="section level3">
<h3 id="generalized-additive-models">2. Generalized Additive Models<a class="anchor" aria-label="anchor" href="#generalized-additive-models"></a>
</h3>
<p>The GAM models the time series as a semiparametric smooth using a
Generalized Additive Model (GAM) structure. This model is unique among
the bbsBayes2 models in that it does not model annual fluctuations, only
smoothed changes in population size through time. As a result, it makes
some very strong assumptions about population change. See <a href="https://doi.org/10.1093/ornithapp/duaa065" class="external-link">Smith &amp; Edwards,
2021</a> for the original formulation. The updated hierarchical and
spatial variants of this model are described in this <a href="https://doi.org/10.1093/ornithapp/duad056" class="external-link">Smith et al.,
2024</a>.</p>
</div>
<div class="section level3">
<h3 id="generalized-additive-models-with-year-effect">3. Generalized Additive Models with Year Effect<a class="anchor" aria-label="anchor" href="#generalized-additive-models-with-year-effect"></a>
</h3>
<p>The GAMYE includes the semiparametric smooth used in the gam option,
but also includes random year-effect terms that track annual
fluctuations around the smooth. This is the model that the Canadian
Wildlife Service is now using for the annual status and trend estimates.
See this <a href="https://doi.org/10.1093/ornithapp/duad056" class="external-link">Smith et
al., 2024</a> for details on the Stan version of this model and see <a href="https://doi.org/10.1093/ornithapp/duaa065" class="external-link">Smith &amp; Edwards,
2021</a> for the original formulation.</p>
</div>
<div class="section level3">
<h3 id="slope">4. Slope<a class="anchor" aria-label="anchor" href="#slope"></a>
</h3>
<p>The slope model estimates the time series as a log-linear regression
with random year-effect terms that allow the trajectory to depart from
the smooth log-linear regression line. It is the model used by the USGS
and CWS to estimate BBS trends between 2011 and 2018. The basic model
was first described in 2002 <a href="https://doi.org/10.1890/0012-9658(2002)083%5B2832:AHAOPC%5D2.0.CO;2" class="external-link">Link
and Sauer 2002</a> and its application to the annual status and trend
estimates is documented in <a href="https://doi.org/10.1525/auk.2010.09220" class="external-link">Sauer and Link, 2011</a>
and <a href="https://doi.org/10.22621/cfn.v128i2.1565" class="external-link">Smith et al.,
2014</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="the-variants">The variants<a class="anchor" aria-label="anchor" href="#the-variants"></a>
</h2>
<p>The variants differ in the way they treat the variation among strata
in the abundance and trend components of the models.</p>
<div class="section level3">
<h3 id="hierarchical-variants">Hierarchical variants<a class="anchor" aria-label="anchor" href="#hierarchical-variants"></a>
</h3>
<p>Hierarchical variants <code>variant = "hier"</code> are the default
variants for each model. These variants share information on species
abundance and population trends, so that estimates in each stratum are
pulled <em>shrunk</em> closer to the mean across all strata. The
abundance and trend parameters are estimated as <em>hierarchical</em>
effects (also sometimes called <em>random effects</em> or <em>partial
pooling</em>) where the strata are treated as the groups and parameters
are allowed to vary among groups. The among-strata variation is modeled
as a relatively simple normal distribution with an estimated mean and
standard deviation.</p>
</div>
<div class="section level3">
<h3 id="spatial-variants">Spatial variants<a class="anchor" aria-label="anchor" href="#spatial-variants"></a>
</h3>
<p>Spatial variants <code>variant = "spatial"</code> are both
hierarchical and spatial, sharing information among strata on the
abundance and trends, and sharing in an explicitly spatial way. This
means that each stratum’s estimates will be pulled closer to the mean of
its neighbors. The spatial components are estimated using an intrinsic
Conditional Autoregressive (iCAR) structure <a href="https://doi.org/10.1007/BF00116466" class="external-link">Besag et al. 1991</a>, <a href="http://doi.wiley.com/10.1002/ecm.1283" class="external-link">ver Hoef et al. 2018</a>,
using Stan code derived from <a href="https://doi.org/10.1016/j.sste.2019.100301" class="external-link">Morris et
al. 2019</a></p>
</div>
<div class="section level3">
<h3 id="non-hierarchical-variant-first-difference-only">Non-hierarchical variant (first-difference only)<a class="anchor" aria-label="anchor" href="#non-hierarchical-variant-first-difference-only"></a>
</h3>
<p>The non-hierarchical variant of the first-difference model
<code>model = "first_diff", variant = "nonhier"</code> does not share
information among strata on the abundance and trends components. It is
included to support an approximate replication of the USGS trend
analyses. It estimates abundance and population trends in each stratum
independently of their estimates in all other strata. Importantly,
although we refer to this model as non-hierarchical, that only refers to
the among-strata sharing of information. It is a <em>hierarchical</em>
model; It uses hierarchical structures to model the variation among
routes and observers, and the annual differences in populations within
strata are also modeled as hierarchical effects.</p>
</div>
</div>
<div class="section level2">
<h2 id="more-background-reading">More background reading<a class="anchor" aria-label="anchor" href="#more-background-reading"></a>
</h2>
<p>The models in bbsBayes2 are best described and contrasted here <a href="https://doi.org/10.1093/ornithapp/duad056" class="external-link">Smith et al.,
2024</a>.</p>
<p>The models and variants differ in the way they estimate the
parameters that are most important for understanding the status and
trends of bird populations. That is, they vary in the way they estimate
the relative abundance and the temporal-changes in relative abundance
(population trends), within and among strata. Otherwise, they are
identical in that they all share the same set of parameters and priors
designed to adjust estimates for variations among observers, routes, and
first-year observer start-up effects. For more details on the
development of these Bayesian hierarchical models for the BBS and the
observer-effects, see <a href="https://doi.org/10.1890/0012-9658(2002)083%5B2832:AHAOPC%5D2.0.CO;2" class="external-link">Link
and Sauer 2002</a>, <a href="https://doi.org/10.1525/auk.2010.09220" class="external-link">Sauer and Link, 2011</a>,
<a href="https://doi.org/10.22621/cfn.v128i2.1565" class="external-link">Smith et al.,
2014</a>, <a href="https://doi.org/10.1650/CONDOR-17-1.1" class="external-link">Link et al.,
2017</a>, <a href="https://doi.org/10.1002/eap.2137" class="external-link">Link et
al. 2020</a>, <a href="https://doi.org/10.1093/ornithapp/duaa065" class="external-link">Smith
&amp; Edwards, 2021</a>.</p>
</div>
<div class="section level2">
<h2 id="one-species-nine-models">One species, nine-models<a class="anchor" aria-label="anchor" href="#one-species-nine-models"></a>
</h2>
<p>Here is an example application of all nine models and variants
applied to the same data set. In this example, we’ve used data for the
Scissor-tailed Flycatcher.</p>
<p>You can download the fitted model results for all nine models in a
zipped file <a href="https://drive.google.com/drive/folders/1m45wWySCJYxh4DZGfvp_xI8fRUEsE5e1?usp=sharing" class="external-link">here</a>.
Unzip the file and save the <em>.rds</em> files in a sub-directory of
your working directory called <em>output</em> to replicate our code
below. The following code chunk loads each of the fitted model objects,
calculates the annual indices and trends, then saves the continent
population trajectories and the long-term (1966-2023) trend maps.</p>
<p>This code was used to generate these fitted model results.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bbsBayes/bbsBayes2" class="external-link">bbsBayes2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">species</span> <span class="op">&lt;-</span> <span class="st">"Scissor-tailed Flycatcher"</span></span>
<span></span>
<span><span class="co"># extract the unique numerical identifier for this species in the BBS database</span></span>
<span><span class="va">species_number</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_species.html">search_species</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">aou</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stratify.html">stratify</a></span><span class="op">(</span><span class="st">"bbs_usgs"</span>,</span>
<span>              species <span class="op">=</span> <span class="va">species</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/prepare_data.html">prepare_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bbs_models</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">bbs_models</span><span class="op">[</span><span class="va">j</span>,<span class="st">"model"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">bbs_models</span><span class="op">[</span><span class="va">j</span>,<span class="st">"variant"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">var</span> <span class="op">==</span> <span class="st">"spatial"</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_spatial.html">prepare_spatial</a></span><span class="op">(</span><span class="va">s</span>, strata_map <span class="op">=</span> <span class="fu"><a href="../reference/load_map.html">load_map</a></span><span class="op">(</span><span class="st">"bbs_usgs"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/prepare_model.html">prepare_model</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span>, model_variant <span class="op">=</span> <span class="va">var</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_model.html">prepare_model</a></span><span class="op">(</span><span class="va">s</span>,model <span class="op">=</span> <span class="va">mod</span>,</span>
<span>                     model_variant <span class="op">=</span> <span class="va">var</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"output/"</span>,</span>
<span>                      <span class="va">species_number</span>,</span>
<span>                      <span class="st">"_"</span>,</span>
<span>                      <span class="va">mod</span>,</span>
<span>                      <span class="st">"_"</span>,</span>
<span>                      <span class="va">var</span><span class="op">)</span></span>
<span>  <span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_model.html">run_model</a></span><span class="op">(</span><span class="va">p</span>,</span>
<span>                 output_basename <span class="op">=</span> <span class="va">m</span>,</span>
<span>                 output_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">saved_trajectories</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">saved_trend_maps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>,<span class="fl">9</span><span class="op">)</span></span>
<span><span class="va">species</span> <span class="op">&lt;-</span> <span class="st">"Scissor-tailed Flycatcher"</span></span>
<span><span class="co"># extract the unique numerical identifier for this species in the BBS database</span></span>
<span><span class="va">species_number</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_species.html">search_species</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">aou</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bbs_models</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"output/"</span>,</span>
<span>                      <span class="va">species_number</span>,</span>
<span>                      <span class="st">"_"</span>,</span>
<span>                      <span class="va">bbs_models</span><span class="op">[</span><span class="va">j</span>,<span class="st">"model"</span><span class="op">]</span>,</span>
<span>                      <span class="st">"_"</span>,</span>
<span>                      <span class="va">bbs_models</span><span class="op">[</span><span class="va">j</span>,<span class="st">"variant"</span><span class="op">]</span>,</span>
<span>                      <span class="st">".rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_indices.html">generate_indices</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">trajs</span> <span class="op">&lt;-</span> <span class="va">i</span><span class="op">$</span><span class="va">indices</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">region</span> <span class="op">==</span> <span class="st">"continent"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">bbs_models</span><span class="op">[</span><span class="va">j</span>,<span class="st">"model"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>           variant <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">bbs_models</span><span class="op">[</span><span class="va">j</span>,<span class="st">"variant"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">saved_trajectories</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">saved_trajectories</span>,</span>
<span>                        <span class="va">trajs</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span>  <span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_trends.html">generate_trends</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">strata_with_data</span> <span class="op">&lt;-</span> <span class="va">t</span><span class="op">$</span><span class="va">meta_strata</span> <span class="co"># meta data in trend object - strata information</span></span>
<span><span class="co"># load the original strata map used in the model fitting</span></span>
<span><span class="co"># then filter to just the strata with data for this species</span></span>
<span><span class="va">data_bounding_box</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_map.html">load_map</a></span><span class="op">(</span>stratify_by <span class="op">=</span> <span class="va">t</span><span class="op">$</span><span class="va">meta_data</span><span class="op">$</span><span class="va">stratify_by</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">strata_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">strata_with_data</span><span class="op">$</span><span class="va">strata_name</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># create a bounding box for x and y limits</span></span>
<span></span>
<span>  <span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_map.html">plot_map</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">bbs_models</span><span class="op">[</span><span class="va">j</span>,<span class="st">"model"</span><span class="op">]</span>,</span>
<span>                       <span class="va">bbs_models</span><span class="op">[</span><span class="va">j</span>,<span class="st">"variant"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="va">data_bounding_box</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"xmin"</span>,<span class="st">"xmax"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>           ylim <span class="op">=</span> <span class="va">data_bounding_box</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ymin"</span>,<span class="st">"ymax"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">saved_trend_maps</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">map</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This species has moderately rich data across much of its range (the
portion of its range covered by the BBS surveys), so the estimated
population trajectories are very similar across the different
models.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="va">traj_panel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">saved_trajectories</span>,</span>
<span>                     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">index</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">index_q_0.025</span>,</span>
<span>                  ymax <span class="op">=</span> <span class="va">index_q_0.975</span>,</span>
<span>                  fill <span class="op">=</span> <span class="va">variant</span><span class="op">)</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">variant</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">obs_mean</span><span class="op">)</span>,</span>
<span>             alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span>aesthetics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"colour"</span>,<span class="st">"fill"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">traj_panel</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 9 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="figures%2Fmodels_unnamed-chunk-5-1.png" alt="Population trajectory graphs for Scissor-tailed Flycatcher estimated using the 9 different models and their variants available in bbsBayes2"></p>
<p>Similarly, the long-term trend maps are generally similar across the
different models and variants.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">map_panel</span> <span class="op">&lt;-</span> <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span><span class="va">saved_trend_maps</span>,</span>
<span>                                    ncol <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                    guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">map_panel</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures%2Fmodels_unnamed-chunk-6-1.png" alt="Population trend maps for Scissor-tailed Flycatcher estimated using the 9 different models and their variants available in bbsBayes2"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Brandon P.M. Edwards, Adam C. Smith, Steffi LaZerte.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
