# Return the `cmdstanr` summary

Extract and return the model summary using
[`cmdstanr::summary()`](https://mc-stan.org/cmdstanr/reference/fit-method-summary.html).

## Usage

``` r
get_summary(model_output, variables = NULL)
```

## Arguments

- model_output:

  List. Model output generated by
  [`run_model()`](https://bbsbayes.github.io/bbsBayes2/reference/run_model.md).

- variables:

  Character vector. Specific variables (e.g., `"strata_raw[1]"`) or
  variable types (e.g., `"strata_raw"`) for which to calculate metrics.
  If `NULL` (default) all variables are returned.

## Value

A data frame of model summary statistics, matching the output of
[`cmdstanr::summary()`](https://mc-stan.org/cmdstanr/reference/fit-method-summary.html)
plus one additional column `variable_type` that identifies categories of
parameters (e.g., `n` for all of the annual indices for every stratum
and year).

## See also

Other model assessment functions:
[`get_convergence()`](https://bbsbayes.github.io/bbsBayes2/reference/get_convergence.md),
[`get_model_vars()`](https://bbsbayes.github.io/bbsBayes2/reference/get_model_vars.md)

## Examples

``` r
# Temporarily suppress convergence warning for legibility
# "The ESS has been capped to avoid unstable estimates."
opts <- options(warn = -1)

# Using the example model for Pacific Wrens

get_summary(pacific_wren_model)
#> # A tibble: 10,917 × 11
#>    variable_type variable          mean   median     sd    mad       q5      q95
#>    <chr>         <chr>            <dbl>    <dbl>  <dbl>  <dbl>    <dbl>    <dbl>
#>  1 lp__          lp__          -1.44e+4 -1.44e+4 36.0   33.6   -1.45e+4 -1.44e+4
#>  2 strata_raw    strata_raw[1] -9.51e-1 -9.96e-1  0.514  0.625 -1.71e+0 -1.67e-1
#>  3 strata_raw    strata_raw[2] -2.70e-1 -2.49e-1  0.231  0.162 -6.31e-1  4.68e-2
#>  4 strata_raw    strata_raw[3] -1.33e-1 -1.86e-1  0.570  0.605 -9.74e-1  7.05e-1
#>  5 strata_raw    strata_raw[4]  1.53e+0  1.57e+0  0.279  0.266  1.08e+0  2.03e+0
#>  6 strata_raw    strata_raw[5] -2.25e-1 -1.75e-1  0.260  0.216 -5.83e-1  1.38e-1
#>  7 strata_raw    strata_raw[6]  1.24e+0  1.27e+0  0.607  0.647  2.96e-1  2.04e+0
#>  8 strata_raw    strata_raw[7] -9.12e-1 -9.86e-1  0.485  0.448 -1.49e+0 -1.33e-1
#>  9 strata_raw    strata_raw[8]  1.82e+0  1.82e+0  0.390  0.387  1.27e+0  2.42e+0
#> 10 strata_raw    strata_raw[9] -9.54e-1 -8.51e-1  0.334  0.301 -1.51e+0 -5.56e-1
#> # ℹ 10,907 more rows
#> # ℹ 3 more variables: rhat <dbl>, ess_bulk <dbl>, ess_tail <dbl>
get_summary(pacific_wren_model, variables = "strata_raw")
#> # A tibble: 19 × 11
#>    variable_type variable         mean median    sd   mad      q5     q95  rhat
#>    <chr>         <chr>           <dbl>  <dbl> <dbl> <dbl>   <dbl>   <dbl> <dbl>
#>  1 strata_raw    strata_raw[1]  -0.951 -0.996 0.514 0.625 -1.71   -0.167  1.03 
#>  2 strata_raw    strata_raw[2]  -0.270 -0.249 0.231 0.162 -0.631   0.0468 1.00 
#>  3 strata_raw    strata_raw[3]  -0.133 -0.186 0.570 0.605 -0.974   0.705  0.966
#>  4 strata_raw    strata_raw[4]   1.53   1.57  0.279 0.266  1.08    2.03   0.981
#>  5 strata_raw    strata_raw[5]  -0.225 -0.175 0.260 0.216 -0.583   0.138  1.01 
#>  6 strata_raw    strata_raw[6]   1.24   1.27  0.607 0.647  0.296   2.04   1.24 
#>  7 strata_raw    strata_raw[7]  -0.912 -0.986 0.485 0.448 -1.49   -0.133  1.01 
#>  8 strata_raw    strata_raw[8]   1.82   1.82  0.390 0.387  1.27    2.42   1.03 
#>  9 strata_raw    strata_raw[9]  -0.954 -0.851 0.334 0.301 -1.51   -0.556  0.987
#> 10 strata_raw    strata_raw[10] -0.414 -0.423 0.388 0.333 -1.15    0.204  1.10 
#> 11 strata_raw    strata_raw[11] -0.241 -0.200 0.253 0.220 -0.786   0.0617 0.966
#> 12 strata_raw    strata_raw[12]  0.358  0.336 0.242 0.207  0.0146  0.680  1.02 
#> 13 strata_raw    strata_raw[13] -0.673 -0.605 0.329 0.255 -1.10   -0.196  0.983
#> 14 strata_raw    strata_raw[14] -0.966 -0.932 0.336 0.323 -1.48   -0.486  1.04 
#> 15 strata_raw    strata_raw[15]  0.639  0.672 0.240 0.302  0.289   0.967  1.07 
#> 16 strata_raw    strata_raw[16] -0.822 -0.808 0.456 0.385 -1.45   -0.210  1.06 
#> 17 strata_raw    strata_raw[17] -0.689 -0.614 0.395 0.274 -1.27   -0.224  0.999
#> 18 strata_raw    strata_raw[18]  1.19   1.19  0.358 0.203  0.752   1.71   0.999
#> 19 strata_raw    strata_raw[19]  0.478  0.489 0.330 0.317 -0.0779  1.01   1.07 
#> # ℹ 2 more variables: ess_bulk <dbl>, ess_tail <dbl>
get_summary(pacific_wren_model, variables = "strata_raw[9]")
#> # A tibble: 1 × 11
#>   variable_type variable     mean median    sd   mad    q5    q95  rhat ess_bulk
#>   <chr>         <chr>       <dbl>  <dbl> <dbl> <dbl> <dbl>  <dbl> <dbl>    <dbl>
#> 1 strata_raw    strata_ra… -0.954 -0.851 0.334 0.301 -1.51 -0.556 0.987     64.1
#> # ℹ 1 more variable: ess_tail <dbl>

# Restore warnings
options(opts)
```
