<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Regional annual indices of abundance — generate_indices • bbsBayes2</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Regional annual indices of abundance — generate_indices"><meta name="description" content="Calculate annual indices of relative abundance by year for different regions.
These indices can then be used to plot population trajectories for the
species, and to estimate trends."><meta property="og:description" content="Calculate annual indices of relative abundance by year for different regions.
These indices can then be used to plot population trajectories for the
species, and to estimate trends."><meta property="og:image" content="https://bbsbayes.github.io/bbsBayes2/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bbsBayes2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/bbsBayes2.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bbsBayes/bbsBayes2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Regional annual indices of abundance</h1>
      <small class="dont-index">Source: <a href="https://github.com/bbsBayes/bbsBayes2/blob/main/R/generate-indices.R" class="external-link"><code>R/generate-indices.R</code></a></small>
      <div class="d-none name"><code>generate_indices.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculate annual indices of relative abundance by year for different regions.
These indices can then be used to plot population trajectories for the
species, and to estimate trends.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">generate_indices</span><span class="op">(</span></span>
<span>  model_output <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.05</span>, <span class="fl">0.25</span>, <span class="fl">0.75</span>, <span class="fl">0.95</span>, <span class="fl">0.975</span><span class="op">)</span>,</span>
<span>  regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"continent"</span>, <span class="st">"stratum"</span><span class="op">)</span>,</span>
<span>  regions_index <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  alternate_n <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>  gam_smooths <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  start_year <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_backcast <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  drop_exclude <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  hpdi <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-model-output">model_output<a class="anchor" aria-label="anchor" href="#arg-model-output"></a></dt>
<dd><p>List. Model output generated by <code><a href="run_model.html">run_model()</a></code>.</p></dd>


<dt id="arg-quantiles">quantiles<a class="anchor" aria-label="anchor" href="#arg-quantiles"></a></dt>
<dd><p>Numeric. Vector of quantiles to be sampled from the
posterior distribution. Default is
<code>c(0.025, 0.05, 0.25, 0.5, 0.75, 0.95, 0.975)</code>. Note that these quantiles
will be used to create confidence interval bands in <code><a href="plot_indices.html">plot_indices()</a></code> and
by quantiles in <code><a href="generate_trends.html">generate_trends()</a></code>, so make sure you specify the ones you
want to use later.</p></dd>


<dt id="arg-regions">regions<a class="anchor" aria-label="anchor" href="#arg-regions"></a></dt>
<dd><p>Character. Which region(s) to summarize and calculate indices
for. Default is "continent" and "stratum". Options also include "country",
"prov_state", "bcr", and "bcr_by_country". Note that some regions only
apply to specific stratifications. You can also supply a custom region that
exists as a column in the <code>regions_index</code> data frame (see
examples for more details).</p></dd>


<dt id="arg-regions-index">regions_index<a class="anchor" aria-label="anchor" href="#arg-regions-index"></a></dt>
<dd><p>Data frame. Custom regions to summarize. Data frame must
include all strata in the original data in one column (<code>strata_name</code>), and
any custom regions defined as categories in other columns. See examples for
more details.</p></dd>


<dt id="arg-alternate-n">alternate_n<a class="anchor" aria-label="anchor" href="#arg-alternate-n"></a></dt>
<dd><p>Character. Indicating the name of the alternative annual
index parameter in a model, Default is "n" which for all models represents
an index of the estimated annual relative abundance, scaled as the expected
mean count averaged across all BBS routes and observers in a given stratum
and year. For some of the models included in bbsBayes2, alternatives exist
that provide a partial decomposition of the time-series.
For the "gamye" models, the parameter "n_smooth" represents the smooth-only
version of the annual index of relative abundance (i.e., the component
of the annual index estimated by the spline-based smooth of the GAM).
This "n_smooth" is identical to the "n" values for the same model, but
excludes the annual fluctuations. For the "gamye" models, this "n_smooth"
parameter is likely the most natural parameter to use in estimating trends.
A similar option exists for the "slope" models, where the parameter
"n_slope" represents the component of the population trajectory estimated
by the log-linear regression slope parameters in the model. Users should
be particularly cautious about interpreting this "n_slope" values for
relatively long time-series. As a continuous regression slope, it assumes
interpreting it as an estimate of population trajectory and using it to
generate trend estimates assumes that there is a single continuous rate of
population change across the entire time-series. Biologically, this may be
reasonable for 10-20 year periods, but will be less reasonable for longer
time-periods.</p></dd>


<dt id="arg-gam-smooths">gam_smooths<a class="anchor" aria-label="anchor" href="#arg-gam-smooths"></a></dt>
<dd><p>Logical. Whether to return an array of posterior samples of
gam-based smooths through the full time-series of annual indices. These can
by treated as smooth population trajectories from any model. NOTE: these
gam smooths require fitting mgcv::gam() to every posterior draw of every
possible population trajectory. As a result, generate_indices can require
can require many minutes to complete if set to TRUE.</p></dd>


<dt id="arg-start-year">start_year<a class="anchor" aria-label="anchor" href="#arg-start-year"></a></dt>
<dd><p>Numeric. Trim the data record before calculating annual
indices.</p></dd>


<dt id="arg-max-backcast">max_backcast<a class="anchor" aria-label="anchor" href="#arg-max-backcast"></a></dt>
<dd><p>Numeric. The number of years to back cast stratum-level
estimates before the first year that species was observed on any route in
that stratum. Default is <code>NULL</code>, which generates annual indices for the
entire time series and ignores back-casting. CWS national estimates use a
back cast of 5. Note that unless <code>drop_exclude = TRUE</code>, problematic years
are only flagged, not omitted. See Details for more specifics.</p></dd>


<dt id="arg-drop-exclude">drop_exclude<a class="anchor" aria-label="anchor" href="#arg-drop-exclude"></a></dt>
<dd><p>Logical. Whether or not strata that exceed the
<code>max_backcast</code> threshold should be excluded from the calculations. Default
is <code>FALSE</code> (regions are flagged and listed but not dropped).</p></dd>


<dt id="arg-hpdi">hpdi<a class="anchor" aria-label="anchor" href="#arg-hpdi"></a></dt>
<dd><p>Logical. Should credible intervals and limits be calculated using
highest posterior density intervals instead of simple quantiles of the
posterior distribution. Default is <code>FALSE</code>. these intervals are often a
better descriptor of skewed posterior distributions, such as the predicted
mean counts that the indices represent.
Note hpd intervals are not stable for small percentages of the posterior
distribution, and so <code>hpdi = TRUE</code> is ignored for <code>quantiles</code> values
between 0.33 and 0.67 (i.e., if the <code>quantiles</code> value defines a limit for
a centered hpd interval that would include &lt; 33% of the
posterior distribution).</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>Logical. Suppress progress messages? Default <code>FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing</p><ul><li><p><code>indices</code> - data frame of calculated regional annual indices of
abundances</p></li>
<li><p><code>samples</code> - array of posterior draws from the model</p></li>
<li><p><code>meta_data</code> - meta data defining the analysis</p></li>
<li><p><code>meta_strata</code> - data frame listing strata meta data</p></li>
<li><p><code>raw_data</code> - data frame of summarized counts</p></li>
<li><p><code>gam_smooth_samples</code> - optional-array of posterior draws of the gam smooth</p></li>
</ul><p><strong><code>indices</code></strong> contains the following columns:</p><ul><li><p><code>year</code> - Year of particular index</p></li>
<li><p><code>region</code> - Region name</p></li>
<li><p><code>region_type</code> - Type of region</p></li>
<li><p><code>strata_included</code> - Strata <em>potentially</em> included in the annual index
calculations</p></li>
<li><p><code>strata_excluded</code> - Strata <em>potentially</em> excluded from the annual index
calculations because they have no observations of the species in the first
part of the time series, see arguments <code>max_backcast</code> and <code>start_year</code></p></li>
<li><p><code>index</code> - Strata-weighted count index (median)</p></li>
<li><p><code>index_q_XXX</code> - Strata-weighted count index (by different quantiles)</p></li>
<li><p><code>obs_mean</code> - Mean observed annual counts of birds across all routes and
all years. An alternative estimate of the average relative abundance of the
species in the region and year. Differences between this and the annual
indices are a function of the model. For composite regions (i.e., anything
other than stratum-level estimates) this average count is calculated as an
area-weighted average across all strata included</p></li>
<li><p><code>n_routes</code> - Number of BBS routes that contributed data for this species,
region, and year</p></li>
<li><p><code>n_routes_total</code> - Number of BBS routes that contributed data for this
species and region for all years in the selected time-series, i.e., all
years since <code>start_year</code></p></li>
<li><p><code>n_non_zero</code> - Number of BBS routes on which this species was observed
(i.e., count is &gt; 0) in this region and year</p></li>
<li><p><code>backcast_flag</code> - Approximate annual average proportion of the covered
species range that is free of extrapolated population trajectories. e.g.,
if 1.0, data cover full time-series; if 0.75, data cover 75 percent of
time-series. Only calculated if <code>max_backcast != NULL</code>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>max_backcast</code> is a way to deal with the fact that the species of interest
may not appear in the data until several years after the start of the
time-series <code>max_backcast</code> specifies how many years can occur before the
stratum is flagged. A <code>max_backcast</code> of 5 will flag any stratum without a
non-zero (or non-NA) observation within the first 5 years of the time-
series. Note that records are <em>only</em> flagged unless <code>drop_exclude = TRUE</code>.
If you find that the early data record is sparse and results in the
exclusion of many strata, consider trimming the early years by specifying a
<code>start_year</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other indices and trends functions:
<code><a href="generate_trends.html">generate_trends</a>()</code>,
<code><a href="plot_geofacet.html">plot_geofacet</a>()</code>,
<code><a href="plot_indices.html">plot_indices</a>()</code>,
<code><a href="plot_map.html">plot_map</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Using the example model for Pacific Wrens</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generate the continental and stratum indices</span></span></span>
<span class="r-in"><span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fu">generate_indices</span><span class="op">(</span><span class="va">pacific_wren_model</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Processing region continent</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Processing region stratum</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generate the continental and stratum indices using hpdi</span></span></span>
<span class="r-in"><span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fu">generate_indices</span><span class="op">(</span><span class="va">pacific_wren_model</span>, hpdi <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Processing region continent</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Processing region stratum</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generate only country indices</span></span></span>
<span class="r-in"><span><span class="va">i_nat</span> <span class="op">&lt;-</span> <span class="fu">generate_indices</span><span class="op">(</span><span class="va">pacific_wren_model</span>, regions <span class="op">=</span> <span class="st">"country"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Processing region country</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use a custom region specification (dummy example)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘dplyr’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:stats’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     filter, lag</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     intersect, setdiff, setequal, union</span>
<span class="r-in"><span><span class="va">ri</span> <span class="op">&lt;-</span> <span class="va">bbs_strata</span><span class="op">[[</span><span class="st">"bbs_cws"</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">ri</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">ri</span>, my_region <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">prov_state</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"ON"</span>,</span></span>
<span class="r-in"><span>                                     <span class="st">"Ontario"</span>, <span class="st">"Rest"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generate indices with these custom regions</span></span></span>
<span class="r-in"><span><span class="va">i_custom</span> <span class="op">&lt;-</span> <span class="fu">generate_indices</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">pacific_wren_model</span>,</span></span>
<span class="r-in"><span>  regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="st">"prov_state"</span>, <span class="st">"my_region"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  regions_index <span class="op">=</span> <span class="va">ri</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Processing region country</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Processing region prov_state</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Processing region my_region</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Brandon P.M. Edwards, Adam C. Smith, Steffi LaZerte.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

