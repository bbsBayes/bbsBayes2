<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Prepare model parameters — prepare_model • bbsBayes2</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Prepare model parameters — prepare_model"><meta name="description" content="Calculate and format the prepared data for use in modelling. Different
parameters are definied for different types of models (see ?bbs_models for
a list of models included in bbsBayes2)."><meta property="og:description" content="Calculate and format the prepared data for use in modelling. Different
parameters are definied for different types of models (see ?bbs_models for
a list of models included in bbsBayes2)."><meta property="og:image" content="https://bbsbayes.github.io/bbsBayes2/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bbsBayes2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/bbsBayes2.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bbsBayes/bbsBayes2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Prepare model parameters</h1>
      <small class="dont-index">Source: <a href="https://github.com/bbsBayes/bbsBayes2/blob/v.1.1.3.1/R/prepare-model.R" class="external-link"><code>R/prepare-model.R</code></a></small>
      <div class="d-none name"><code>prepare_model.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculate and format the prepared data for use in modelling. Different
parameters are definied for different types of models (see <code><a href="bbs_models.html">?bbs_models</a></code> for
a list of models included in bbsBayes2).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">prepare_model</span><span class="op">(</span></span>
<span>  <span class="va">prepared_data</span>,</span>
<span>  <span class="va">model</span>,</span>
<span>  model_variant <span class="op">=</span> <span class="st">"hier"</span>,</span>
<span>  model_file <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_pois <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  heavy_tailed <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_knots <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  basis <span class="op">=</span> <span class="st">"mgcv"</span>,</span>
<span>  calculate_nu <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  calculate_log_lik <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  calculate_cv <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cv_k <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  cv_fold_groups <span class="op">=</span> <span class="st">"obs_n"</span>,</span>
<span>  cv_omit_singles <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  use_likelihood <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  set_seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-prepared-data">prepared_data<a class="anchor" aria-label="anchor" href="#arg-prepared-data"></a></dt>
<dd><p>List. Prepared data generated by <code><a href="prepare_data.html">prepare_data()</a></code> (if
<code>model-variant</code> is not <code>spatial</code>) or <code><a href="prepare_spatial.html">prepare_spatial()</a></code> (if
<code>model_variant</code> is <code>"spatial"</code>).</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>Character. Type of model to use, must be one of "first_diff"
(First Differences), "gam" (General Additive Model), "gamye" (General
Additive Model with Year Effect), or "slope" (Slope model).</p></dd>


<dt id="arg-model-variant">model_variant<a class="anchor" aria-label="anchor" href="#arg-model-variant"></a></dt>
<dd><p>Character. Model variant to use, must be one of
"nonhier" (Non-hierarchical), "hier" (Hierarchical; default), or "spatial"
(Spatially explicit).</p></dd>


<dt id="arg-model-file">model_file<a class="anchor" aria-label="anchor" href="#arg-model-file"></a></dt>
<dd><p>Character. Optional location of a custom Stan model file to
use.</p></dd>


<dt id="arg-use-pois">use_pois<a class="anchor" aria-label="anchor" href="#arg-use-pois"></a></dt>
<dd><p>Logical. Whether to use an Over-Dispersed Poisson model
(<code>TRUE</code>) or an Negative Binomial model (<code>FALSE</code>; default).</p></dd>


<dt id="arg-heavy-tailed">heavy_tailed<a class="anchor" aria-label="anchor" href="#arg-heavy-tailed"></a></dt>
<dd><p>Logical. Whether extra-Poisson error distributions should
be modelled as a t-distribution, with heavier tails than the standard
normal distribution. Default <code>TRUE</code>. Recent results suggest this is best
even though it requires much longer convergence times. Can only be set to
<code>FALSE</code> with Poisson models (i.e. <code>use_pois = TRUE</code>).</p></dd>


<dt id="arg-n-knots">n_knots<a class="anchor" aria-label="anchor" href="#arg-n-knots"></a></dt>
<dd><p>Numeric. Number of knots for "gam" and "gamye" models</p></dd>


<dt id="arg-basis">basis<a class="anchor" aria-label="anchor" href="#arg-basis"></a></dt>
<dd><p>Character. Basis function to use for GAM smooth, one of
"original" or "mgcv". Default is "original", the same basis used in Smith
and Edwards 2020. "mgcv" is an alternate that uses the "tp" basis from the
package mgcv (also used in brms, and rstanarm). If using the "mgcv" option,
the user may want to consider adjusting the prior distributions for the
parameters and their precision.</p></dd>


<dt id="arg-calculate-nu">calculate_nu<a class="anchor" aria-label="anchor" href="#arg-calculate-nu"></a></dt>
<dd><p>Logical. Whether to calculate the <code>nu</code> parameter as
a factor of <code>gamma(2, 0.1)</code>. Default <code>FALSE</code>.</p></dd>


<dt id="arg-calculate-log-lik">calculate_log_lik<a class="anchor" aria-label="anchor" href="#arg-calculate-log-lik"></a></dt>
<dd><p>Logical. Whether to calculate point-wise
log-likelihood of the data given the model. Default <code>FALSE</code>.</p></dd>


<dt id="arg-calculate-cv">calculate_cv<a class="anchor" aria-label="anchor" href="#arg-calculate-cv"></a></dt>
<dd><p>Logical. Whether to use bbsBayes2' cross validation.
Note this is <strong>experimental</strong>. See Details.</p></dd>


<dt id="arg-cv-k">cv_k<a class="anchor" aria-label="anchor" href="#arg-cv-k"></a></dt>
<dd><p>Numeric. The number of K folds to include (only relevant if
<code>calculate_cv = TRUE</code>). Default 10. Note this is <strong>experimental</strong>.</p></dd>


<dt id="arg-cv-fold-groups">cv_fold_groups<a class="anchor" aria-label="anchor" href="#arg-cv-fold-groups"></a></dt>
<dd><p>Character. The data column to use when determining the
grouping level of the observations to be assigned to different fold groups.
Must be one of <code>obs_n</code> (default) or <code>routes</code> (only relevant if
<code>calculate_cv = TRUE</code>). Note this is <strong>experimental</strong>. See the <a href="https://bbsBayes.github.io/bbsBayes2/articles/models.html" class="external-link">models article</a> for more
details.</p></dd>


<dt id="arg-cv-omit-singles">cv_omit_singles<a class="anchor" aria-label="anchor" href="#arg-cv-omit-singles"></a></dt>
<dd><p>Logical. Whether to omit test groups with no
replication (only relevant if <code>calculate_cv = TRUE</code>). Default <code>TRUE.</code> See
the <a href="https://bbsBayes.github.io/bbsBayes2/articles/models.html" class="external-link">models article</a> for more
details.</p></dd>


<dt id="arg-use-likelihood">use_likelihood<a class="anchor" aria-label="anchor" href="#arg-use-likelihood"></a></dt>
<dd><p>Logical. If set to FALSE generates prior predictions
i.e., ignores the likelihood of the count data. Default TRUE</p></dd>


<dt id="arg-set-seed">set_seed<a class="anchor" aria-label="anchor" href="#arg-set-seed"></a></dt>
<dd><p>Numeric. If <code>NULL</code> (default) no seed is set. Otherwise an
integer number to be used with <code><a href="https://withr.r-lib.org/reference/with_seed.html" class="external-link">withr::with_seed()</a></code> internally to ensure
reproducibility.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>Logical. Suppress progress messages? Default <code>FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list of prepared data.</p><ul><li><p><code>model_data</code> - list of data formatted for use in Stan modelling</p></li>
<li><p><code>init_values</code> - list of initialization parameters</p></li>
<li><p><code>folds</code> - a vector of k-fold groups each
observation is assigned to (if <code>calculate_cv = TRUE</code>), or <code>NULL</code></p></li>
<li><p><code>meta_data</code> - meta data defining the analysis</p></li>
<li><p><code>meta_strata</code> - data frame listing strata meta data</p></li>
<li><p><code>raw_data</code> - data frame of summarized counts used to create <code>model_data</code>
(just formatted more nicely)</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>There are ways you can customize the model run.
You can supply a custom <code>model_file</code> created with the
<code><a href="copy_model_file.html">copy_model_file()</a></code> function and then edited manually.</p>
<p>You can edit or overwrite the initialization values (<code>init_values</code>)
in the output of <code>prepare_model()</code> to customize the values
supplied to <code><a href="https://mc-stan.org/cmdstanr/reference/model-method-sample.html" class="external-link">cmdstanr::sample()</a></code>. In previous versions of bbsBayes2, these
initial values were specific to the model and model version. Since version
1.1.3, the initial values supplied by defaul in <code>prepare_model()</code> are a
single value <code>$init_values = 1</code>, which This initializes all parameters
randomly between <code>-1</code> and <code>1</code>⁠ on the unconstrained parameter space.
You can change these initial values and supply alternate initialization
values in any way that <code><a href="https://mc-stan.org/cmdstanr/reference/model-method-sample.html" class="external-link">cmdstanr::sample()</a></code> accepts the <code>init</code> argument,
using the <code>init_alternate</code> argument in <code><a href="run_model.html">run_model()</a></code>.</p>
<p>To implement bbsBayes2' version of cross validation, set <code>calculate_cv = TRUE</code>. You can set up your own system for cross validation by modifying the
<code>folds</code> list-item in the output of <code>prepare_model()</code>. <strong>Note this is
considered experimental.</strong></p>
<p>See the <a href="https://bbsBayes.github.io/bbsBayes2/articles/models.html" class="external-link">models article</a> for more
advanced examples and explanations.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other Data prep functions:
<code><a href="prepare_data.html">prepare_data()</a></code>,
<code><a href="prepare_spatial.html">prepare_spatial()</a></code>,
<code><a href="stratify.html">stratify()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="stratify.html">stratify</a></span><span class="op">(</span>by <span class="op">=</span> <span class="st">"bbs_cws"</span>, sample_data <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using 'bbs_cws' (standard) stratification</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using sample BBS data...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using species Pacific Wren (sample data)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Filtering to species Pacific Wren (7221)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Stratifying data...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Combining BCR 7 and NS and PEI...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Renaming routes...</span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="prepare_data.html">prepare_data</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pm</span> <span class="op">&lt;-</span> <span class="fu">prepare_model</span><span class="op">(</span><span class="va">p</span>, model <span class="op">=</span> <span class="st">"first_diff"</span>, model_variant <span class="op">=</span> <span class="st">"hier"</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Brandon P.M. Edwards, Adam C. Smith, Steffi LaZerte.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

