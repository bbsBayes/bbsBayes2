<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Run Bayesian model — run_model • bbsBayes2</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Run Bayesian model — run_model"><meta name="description" content="Run Bayesian model with cmdstandr::sample()using prepare data and model
parameters specified in previous steps."><meta property="og:description" content="Run Bayesian model with cmdstandr::sample()using prepare data and model
parameters specified in previous steps."><meta property="og:image" content="https://bbsbayes.github.io/bbsBayes2/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bbsBayes2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/bbsBayes2.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bbsBayes/bbsBayes2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Run Bayesian model</h1>
      <small class="dont-index">Source: <a href="https://github.com/bbsBayes/bbsBayes2/blob/v1.1.2.1/R/run-model.R" class="external-link"><code>R/run-model.R</code></a></small>
      <div class="d-none name"><code>run_model.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Run Bayesian model with <code>cmdstandr::sample()</code>using prepare data and model
parameters specified in previous steps.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">run_model</span><span class="op">(</span></span>
<span>  <span class="va">model_data</span>,</span>
<span>  refresh <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  parallel_chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  iter_warmup <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  iter_sampling <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  adapt_delta <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  max_treedepth <span class="op">=</span> <span class="fl">11</span>,</span>
<span>  k <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  output_basename <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="st">"."</span>,</span>
<span>  save_model <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  retain_csv <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  set_seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  show_exceptions <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  init_alternate <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-model-data">model_data<a class="anchor" aria-label="anchor" href="#arg-model-data"></a></dt>
<dd><p>List. Model data generated by <code><a href="prepare_model.html">prepare_model()</a></code>.</p></dd>


<dt id="arg-refresh">refresh<a class="anchor" aria-label="anchor" href="#arg-refresh"></a></dt>
<dd><p>Numeric. Passed to <code><a href="https://mc-stan.org/cmdstanr/reference/model-method-sample.html" class="external-link">cmdstanr::sample()</a></code>. Number of iterations
between screen updates. If 0, only errors are shown.</p></dd>


<dt id="arg-chains">chains<a class="anchor" aria-label="anchor" href="#arg-chains"></a></dt>
<dd><p>Numeric. Passed to <code><a href="https://mc-stan.org/cmdstanr/reference/model-method-sample.html" class="external-link">cmdstanr::sample()</a></code>. Number of Markov
chains to run.</p></dd>


<dt id="arg-parallel-chains">parallel_chains<a class="anchor" aria-label="anchor" href="#arg-parallel-chains"></a></dt>
<dd><p>Numeric. Passed to <code><a href="https://mc-stan.org/cmdstanr/reference/model-method-sample.html" class="external-link">cmdstanr::sample()</a></code>. Maximum
number of chains to run in parallel.</p></dd>


<dt id="arg-iter-warmup">iter_warmup<a class="anchor" aria-label="anchor" href="#arg-iter-warmup"></a></dt>
<dd><p>Numeric. Passed to <code><a href="https://mc-stan.org/cmdstanr/reference/model-method-sample.html" class="external-link">cmdstanr::sample()</a></code>. Number of warmup
iterations per chain.</p></dd>


<dt id="arg-iter-sampling">iter_sampling<a class="anchor" aria-label="anchor" href="#arg-iter-sampling"></a></dt>
<dd><p>Numeric. Passed to <code><a href="https://mc-stan.org/cmdstanr/reference/model-method-sample.html" class="external-link">cmdstanr::sample()</a></code>. Number of
sampling (post-warmup) iterations per chain.</p></dd>


<dt id="arg-adapt-delta">adapt_delta<a class="anchor" aria-label="anchor" href="#arg-adapt-delta"></a></dt>
<dd><p>Numeric. Passed to <code><a href="https://mc-stan.org/cmdstanr/reference/model-method-sample.html" class="external-link">cmdstanr::sample()</a></code>. The adaptation
target acceptance statistic.</p></dd>


<dt id="arg-max-treedepth">max_treedepth<a class="anchor" aria-label="anchor" href="#arg-max-treedepth"></a></dt>
<dd><p>Numeric. Passed to <code><a href="https://mc-stan.org/cmdstanr/reference/model-method-sample.html" class="external-link">cmdstanr::sample()</a></code>. The maximum
allowed tree depth for the NUTS engine. See <code><a href="https://mc-stan.org/cmdstanr/reference/model-method-sample.html" class="external-link">?cmdstanr::sample</a></code>.</p></dd>


<dt id="arg-k">k<a class="anchor" aria-label="anchor" href="#arg-k"></a></dt>
<dd><p>Numeric. The K-fold group to run for cross-validation. Only relevant
if folds defined by <code>prepare_model(calculate_cv = TRUE)</code> or custom
definition. See <code><a href="prepare_model.html">?prepare_model</a></code> or the <a href="https://bbsBayes.github.io/bbsBayes2/articles/models.html" class="external-link">models article</a> for more
details.</p></dd>


<dt id="arg-output-basename">output_basename<a class="anchor" aria-label="anchor" href="#arg-output-basename"></a></dt>
<dd><p>Character. Name of the files created as part of the
Stan model run and the final model output RDS file if <code>save_model = TRUE</code>.
Defaults to a character string that is unique to the species, model,
model_variant, and system time of <code>model_run()</code> call (nearest minute).</p></dd>


<dt id="arg-output-dir">output_dir<a class="anchor" aria-label="anchor" href="#arg-output-dir"></a></dt>
<dd><p>Character. Directory in which all model files will be
created. Defaults to the working directory, but recommend that the user
sets this to a particular existing directory for better file organization.</p></dd>


<dt id="arg-save-model">save_model<a class="anchor" aria-label="anchor" href="#arg-save-model"></a></dt>
<dd><p>Logical. Whether or not to save the model output to file
as an RDS object with all required data. Defaults to <code>TRUE</code>.</p></dd>


<dt id="arg-overwrite">overwrite<a class="anchor" aria-label="anchor" href="#arg-overwrite"></a></dt>
<dd><p>Logical. Whether to overwrite an existing model output file
when saving.</p></dd>


<dt id="arg-retain-csv">retain_csv<a class="anchor" aria-label="anchor" href="#arg-retain-csv"></a></dt>
<dd><p>Logical. Whether to retain the Stan csv files after the
model has finished running and the fitted object has been saved.
Defaults to <code>FALSE</code> because csv files duplicate information saved in
the model output file save object, when <code>save_model = TRUE</code>, and so for
file organization and efficient use of memory, these are deleted
by default.</p></dd>


<dt id="arg-set-seed">set_seed<a class="anchor" aria-label="anchor" href="#arg-set-seed"></a></dt>
<dd><p>Numeric. If <code>NULL</code> (default) no seed is set. Otherwise an
integer number to be used with <code><a href="https://withr.r-lib.org/reference/with_seed.html" class="external-link">withr::with_seed()</a></code> internally to ensure
reproducibility.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>Logical. Suppress progress messages? Default <code>FALSE</code>.</p></dd>


<dt id="arg-show-exceptions">show_exceptions<a class="anchor" aria-label="anchor" href="#arg-show-exceptions"></a></dt>
<dd><p>Logical.  Passed to <code><a href="https://mc-stan.org/cmdstanr/reference/model-method-sample.html" class="external-link">cmdstanr::sample()</a></code>.
Defaults to FALSE. When TRUE, prints all informational messages from Stan,
for example rejection of the current proposal. Disabled by default in
bbsBayes2, because of the copious informational messages during the
initialization period that have no bearing on model fit. If fitting a
custom model, recommend setting this to TRUE.</p></dd>


<dt id="arg-init-alternate">init_alternate<a class="anchor" aria-label="anchor" href="#arg-init-alternate"></a></dt>
<dd><p>Passed to <code>init</code> argument in <code><a href="https://mc-stan.org/cmdstanr/reference/model-method-sample.html" class="external-link">cmdstanr::sample()</a></code>.
Replaces the initial values in the <code>model_data[["init_values"]]</code> created
by prepare_model. Should accept any of the acceptable approaches to setting
inits argment in <code><a href="https://mc-stan.org/cmdstanr/reference/model-method-sample.html" class="external-link">?cmdstanr::sample</a></code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Other arguments passed on to <code><a href="https://mc-stan.org/cmdstanr/reference/model-method-sample.html" class="external-link">cmdstanr::sample()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>List model fit and other (meta) data.</p><ul><li><p><code>model_fit</code> - cmdstanr model output</p></li>
<li><p><code>model_data</code> - list of data formatted for use in Stan modelling</p></li>
<li><p><code>meta_data</code> - meta data defining the analysis</p></li>
<li><p><code>meta_strata</code> - data frame listing strata meta data</p></li>
<li><p><code>raw_data</code> - data frame of summarized counts</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The model is set up in <code><a href="prepare_model.html">prepare_model()</a></code>. The <code>run_model()</code> function
does the final (and often long-running) step of actually running the model.
Here is where you can tweak how the model will be run (iterations etc.).</p>
<p>See the <a href="https://bbsBayes.github.io/bbsBayes2/articles/models.html" class="external-link">models article</a> for more
advanced examples and explanations.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other modelling functions:
<code><a href="copy_model_file.html">copy_model_file</a>()</code>,
<code><a href="save_model_run.html">save_model_run</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="stratify.html">stratify</a></span><span class="op">(</span>by <span class="op">=</span> <span class="st">"bbs_cws"</span>, sample_data <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using 'bbs_cws' (standard) stratification</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using sample BBS data...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using species Pacific Wren (sample data)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Filtering to species Pacific Wren (7221)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Stratifying data...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Combining BCR 7 and NS and PEI...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Renaming routes...</span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="prepare_data.html">prepare_data</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pm</span> <span class="op">&lt;-</span> <span class="fu"><a href="prepare_model.html">prepare_model</a></span><span class="op">(</span><span class="va">p</span>, model <span class="op">=</span> <span class="st">"first_diff"</span>, model_variant <span class="op">=</span> <span class="st">"hier"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run model (quick and dirty)</span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">run_model</span><span class="op">(</span><span class="va">pm</span>, iter_warmup <span class="op">=</span> <span class="fl">20</span>, iter_sampling <span class="op">=</span> <span class="fl">20</span>, chains <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Running MCMC with 2 chains, at most 4 in parallel...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1 WARNING: There aren't enough warmup iterations to fit the </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1          three stages of adaptation as currently configured. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1          Reducing each adaptation stage to 15%/75%/10% of </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1          the given number of warmup iterations: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1            init_buffer = 3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1            adapt_window = 15 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1            term_buffer = 2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1 Iteration:  1 / 40 [  2%]  (Warmup) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2 WARNING: There aren't enough warmup iterations to fit the </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2          three stages of adaptation as currently configured. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2          Reducing each adaptation stage to 15%/75%/10% of </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2          the given number of warmup iterations: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2            init_buffer = 3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2            adapt_window = 15 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2            term_buffer = 2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2 Iteration:  1 / 40 [  2%]  (Warmup) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1 Iteration: 21 / 40 [ 52%]  (Sampling) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2 Iteration: 21 / 40 [ 52%]  (Sampling) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1 Iteration: 40 / 40 [100%]  (Sampling) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1 finished in 53.1 seconds.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2 Iteration: 40 / 40 [100%]  (Sampling) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2 finished in 56.0 seconds.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Both chains finished successfully.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mean chain execution time: 54.6 seconds.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total execution time: 56.3 seconds.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Saving model output to /home/runner/work/bbsBayes2/bbsBayes2/docs/reference/BBS_PacificWren_first_diff_hier_202410091831_STAN.rds</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Brandon P.M. Edwards, Adam C. Smith, Steffi LaZerte.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

